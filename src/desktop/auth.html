<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="desktop.css">
    </head>
    <body>
        <div id="login">
            <p>Scan this QR code to pair.</p>
            <img id="img-qr">
            <p id="url"></p>
        </div>
        <div id="code" class="hidden can-hide">
            <p>Enter pairing code.</p>
            <input id="mobile-code" maxlength="4">
        </div>

        <script>
            window.api.receive("init", (data) => {
                document.getElementById("img-qr").src = data.qr;
                document.getElementById("url").innerHTML = data.url;
            });

            window.api.receive("readyCode", (data) => {
                document.getElementById("code").classList.remove("hidden");
            });

            // code input
            const input = document.getElementById("mobile-code");
            const mask = /[^a-zA-Z0-9]+/g;

            input.oninput = () => {
                input.value = input.value.replaceAll(mask, ""); // remove invalid
                if(input.value.length == 4)
                    pushCode();
            }

            input.onkeydown = (e) => {
                if(e.key == "Enter" && input.value.length == 4)
                    pushCode();
            }

            function pushCode(){
                window.api.send("code", input.value);
            }
        </script>
    </body>
</html>